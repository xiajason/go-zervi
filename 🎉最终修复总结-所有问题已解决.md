# ğŸ‰ æœ€ç»ˆä¿®å¤æ€»ç»“ - æ‰€æœ‰é—®é¢˜å·²è§£å†³

## ğŸ“… ä¿®å¤æ—¥æœŸ
2025-11-05

## ğŸ¯ ä¿®å¤çš„æ‰€æœ‰é—®é¢˜

### 1. æ•°æ®åº“é…ç½®é—®é¢˜ âœ…

**é—®é¢˜**ï¼šä½¿ç”¨ postgres ç”¨æˆ·ï¼Œéœ€è¦æ”¹ä¸º vuecmf
**è§£å†³**ï¼š
- åˆ›å»ºäº† vuecmf æ•°æ®åº“ç”¨æˆ·ï¼ˆå¯†ç ï¼švuecmfï¼‰
- æ›´æ–°äº† `configs/local.env` é…ç½®
- æˆäºˆäº†æ‰€æœ‰å¿…è¦æƒé™

### 2. ç™»å½•å¯†ç é—®é¢˜ âœ…

**é—®é¢˜**ï¼šadmin è´¦å·å¯†ç å“ˆå¸Œä¸æ­£ç¡®
**è§£å†³**ï¼š
- å‘ç°åŸå¯†ç æ˜¯ "password"
- ç”Ÿæˆäº† "admin123" çš„æ­£ç¡® bcrypt å“ˆå¸Œ
- æ›´æ–°äº†æ•°æ®åº“ä¸­çš„å¯†ç 

### 3. ç™»å½•æ ¼å¼é—®é¢˜ âœ…

**é—®é¢˜**ï¼šVueCMF ä½¿ç”¨ `login_name`ï¼Œåç«¯æœŸæœ› `username`
**è§£å†³**ï¼š
- ä¿®æ”¹äº† `unified_auth_api.go` æ”¯æŒä¸¤ç§æ ¼å¼
- æ”¯æŒæ ‡å‡†æ ¼å¼ï¼š`{"username": "admin", "password": "admin123"}`
- æ”¯æŒ VueCMF æ ¼å¼ï¼š`{"data": {"login_name": "admin", "password": "admin123"}}`

### 4. ç™»å½•å“åº”æ ¼å¼é—®é¢˜ âœ…

**é—®é¢˜**ï¼šç¼ºå°‘ VueCMF éœ€è¦çš„å­—æ®µ
**è§£å†³**ï¼šæ·»åŠ äº†å®Œæ•´çš„å“åº”ç»“æ„

```json
{
  "code": 0,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "token": "...",
    "user": {
      "id": 1,
      "username": "admin",
      "email": "admin@zervigo.com",
      "phone": null,
      "status": "active",
      "role": "super_admin",
      "last_login_ip": "[::1]:xxxxx",
      "last_login_time": "2025-11-05 14:10:42"
    },
    "server": {
      "name": "Zervigo MVP",
      "version": "1.0.0",
      "os": "macOS (darwin)",
      "software": "Go + Gin",
      "mysql": "PostgreSQL 14.19",
      "upload_max_size": "10MB"
    }
  }
}
```

### 5. èœå•æ•°æ®é—®é¢˜ âœ…

**é—®é¢˜**ï¼šèœå•è¡¨ä¸å­˜åœ¨
**è§£å†³**ï¼š
- åˆ›å»ºäº† `vuecmf_menu` è¡¨
- æ·»åŠ äº† 8 æ¡åŸºç¡€èœå•æ•°æ®
- æ‰©å±•äº†è¡¨ç»“æ„ï¼ŒåŒ…å«æ‰€æœ‰å¿…éœ€å­—æ®µ

### 6. èœå•å“åº”æ ¼å¼é—®é¢˜ âœ…

**é—®é¢˜**ï¼šå“åº”æ ¼å¼ä¸ç¬¦åˆ VueCMF è¦æ±‚
**è§£å†³**ï¼š
- code æ”¹ä¸º 0ï¼ˆä¸æ˜¯ 200ï¼‰
- è¿”å› `nav_menu` å¯¹è±¡ï¼ˆä¸æ˜¯æ•°ç»„ï¼‰
- è¿”å› `api_maps` å¯¹è±¡
- èœå•ä»¥ `mid` ä¸º key çš„å¯¹è±¡æ ¼å¼

### 7. èœå•å­—æ®µç¼ºå¤±é—®é¢˜ âœ…

**é—®é¢˜**ï¼šç¼ºå°‘è·¯ç”±å¿…éœ€å­—æ®µ
**è§£å†³**ï¼šæ·»åŠ äº†æ‰€æœ‰å­—æ®µ

| å­—æ®µ | è¯´æ˜ | çŠ¶æ€ |
|------|------|------|
| id | èœå•ID | âœ… |
| pid | çˆ¶èœå•ID | âœ… |
| model_id | æ¨¡å‹ID | âœ… |
| title | æ ‡é¢˜ | âœ… |
| path | è·¯å¾„ | âœ… |
| icon | å›¾æ ‡ | âœ… |
| mid | èœå•è·¯å¾„æ ‡è¯† | âœ… |
| component_tpl | ç»„ä»¶æ¨¡æ¿è·¯å¾„ | âœ… |
| path_name | è·¯ç”±åç§°æ•°ç»„ | âœ… |
| table_name | è¡¨å | âœ… |
| default_action_type | é»˜è®¤åŠ¨ä½œç±»å‹ | âœ… |
| id_path | å±‚çº§è·¯å¾„æ•°ç»„ | âœ… |
| is_tree | æ˜¯å¦æ ‘å½¢ç»“æ„ | âœ… |
| children | å­èœå•å¯¹è±¡ | âœ… |
| sort_num | æ’åº | âœ… |
| status | çŠ¶æ€ | âœ… |

### 8. API æ˜ å°„é—®é¢˜ âœ…

**é—®é¢˜**ï¼š
- API æ˜ å°„è¡¨ä¸å­˜åœ¨
- API æ˜ å°„æœåŠ¡æŸ¥è¯¢é”™è¯¯çš„è¡¨
- èœå•å“åº”ä¸­ api_maps ä¸ºç©ºå¯¹è±¡

**è§£å†³**ï¼š
- åˆ›å»ºäº† `vuecmf_api_map` è¡¨
- ä¿®å¤äº† API æ˜ å°„æœåŠ¡æŸ¥è¯¢
- èœå•å“åº”ä¸­è¿”å›å®Œæ•´çš„ api_maps

### 9. HTTP æ–¹æ³•æ”¯æŒé—®é¢˜ âœ…

**é—®é¢˜**ï¼šèœå•æ¥å£åªæ”¯æŒ GETï¼Œå‰ç«¯ä½¿ç”¨ POST
**è§£å†³**ï¼š
- åŒæ—¶æ³¨å†Œäº† GET å’Œ POST è·¯ç”±
- `/api/v1/menu/nav` æ”¯æŒ POST

### 10. æœåŠ¡å‡­è¯é—®é¢˜ âœ…

**é—®é¢˜**ï¼šcentral-brain æœåŠ¡è®¤è¯å¤±è´¥
**è§£å†³**ï¼š
- ç”Ÿæˆäº†æ­£ç¡®çš„ bcrypt å“ˆå¸Œ
- æ›´æ–°äº†æ•°æ®åº“ä¸­çš„æœåŠ¡å‡­è¯

---

## ğŸ“Š å®Œæ•´çš„æ•°æ®ç»“æ„å¯¹ç…§

### å‰ç«¯æœŸæœ› â†’ åç«¯è¿”å› â†’ æ•°æ®åº“å­—æ®µ

#### ç”¨æˆ·ä¿¡æ¯
| å‰ç«¯å­—æ®µ | åç«¯å­—æ®µ | æ•°æ®åº“å­—æ®µ | çŠ¶æ€ |
|---------|---------|-----------|------|
| user.id | user.id | id | âœ… |
| user.username | user.username | username | âœ… |
| user.email | user.email | email | âœ… |
| user.phone | user.phone | phone | âœ… |
| user.status | user.status | status | âœ… |
| user.role | user.role | (æŸ¥è¯¢è§’è‰²è¡¨) | âœ… |
| user.last_login_ip | user.last_login_ip | (è¯·æ±‚IP) | âœ… |
| user.last_login_time | user.last_login_time | last_login_at | âœ… |

#### æœåŠ¡å™¨ä¿¡æ¯
| å‰ç«¯å­—æ®µ | åç«¯å­—æ®µ | å€¼ | çŠ¶æ€ |
|---------|---------|-----|------|
| server.name | server.name | Zervigo MVP | âœ… |
| server.version | server.version | 1.0.0 | âœ… |
| server.os | server.os | macOS (darwin) | âœ… |
| server.software | server.software | Go + Gin | âœ… |
| server.mysql | server.mysql | PostgreSQL 14.19 | âœ… |
| server.upload_max_size | server.upload_max_size | 10MB | âœ… |

#### èœå•ä¿¡æ¯ï¼ˆæ¯ä¸ªèœå•é¡¹ï¼‰
| å‰ç«¯å­—æ®µ | åç«¯å­—æ®µ | æ•°æ®åº“å­—æ®µ | çŠ¶æ€ |
|---------|---------|-----------|------|
| menu.id | id | menu_id | âœ… |
| menu.pid | pid | pid | âœ… |
| menu.title | title | title | âœ… |
| menu.mid | mid | mid | âœ… |
| menu.icon | icon | icon | âœ… |
| menu.component_tpl | component_tpl | component_tpl | âœ… |
| menu.path_name | path_name | path_name (è½¬æ•°ç»„) | âœ… |
| menu.table_name | table_name | table_name | âœ… |
| menu.default_action_type | default_action_type | default_action_type | âœ… |
| menu.id_path[0] | id_path | id_path (è½¬æ•°ç»„) | âœ… |
| menu.is_tree | is_tree | is_tree | âœ… |
| menu.children | children | (æ„å»ºæ ‘å½¢) | âœ… |

---

## ğŸš€ ç™»å½•å‡­è¯

- **URL**: http://localhost:8081
- **ç”¨æˆ·å**: admin
- **å¯†ç **: admin123
- **è§’è‰²**: super_admin
- **æ•°æ®åº“**: PostgreSQL (vuecmf/vuecmf)

---

## ğŸ“ æœåŠ¡ç®¡ç†

### å¯åŠ¨æœåŠ¡
```bash
# ä½¿ç”¨ä¸€é”®å¯åŠ¨è„šæœ¬
bash /Users/szjason72/gozervi/zervigo.demo/ä¸€é”®ä¿®å¤å¯åŠ¨.sh

# æˆ–æ‰‹åŠ¨å¯åŠ¨
cd /Users/szjason72/gozervi/zervigo.demo/services/core/auth
DATABASE_URL="postgres://vuecmf:vuecmf@localhost:5432/zervigo_mvp?sslmode=disable" \
JWT_SECRET="zervigo-mvp-secret-key-2025" \
nohup go run main.go > /tmp/auth.log 2>&1 &

cd /Users/szjason72/gozervi/zervigo.demo/shared/central-brain
nohup go run . > /tmp/brain.log 2>&1 &
```

### éªŒè¯æœåŠ¡
```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
lsof -i :8207  # Auth Service
lsof -i :9000  # Central Brain

# æµ‹è¯•æ¥å£
curl http://localhost:8207/health
curl http://localhost:9000/health
curl -X POST http://localhost:9000/api/v1/menu/nav | jq .
```

### æŸ¥çœ‹æ—¥å¿—
```bash
tail -f /tmp/auth.log
tail -f /tmp/brain.log
```

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šç™»å½•å¤±è´¥
- æ£€æŸ¥ Auth Service æ˜¯å¦è¿è¡Œï¼š`lsof -i :8207`
- æŸ¥çœ‹æ—¥å¿—ï¼š`tail -30 /tmp/auth.log`
- éªŒè¯å¯†ç ï¼šadmin123

### é—®é¢˜ï¼šèœå•åŠ è½½å¤±è´¥
- æ£€æŸ¥ Central Brain æ˜¯å¦è¿è¡Œï¼š`lsof -i :9000`
- æµ‹è¯•èœå•æ¥å£ï¼š`curl -X POST http://localhost:9000/api/v1/menu/nav | jq .`
- æŸ¥çœ‹æ§åˆ¶å°çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯

### é—®é¢˜ï¼š404 é”™è¯¯
- æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
- ä½¿ç”¨æ— ç—•æ¨¡å¼æµ‹è¯•
- éªŒè¯åç«¯æ¥å£æ˜¯å¦çœŸçš„è¿”å› 200

---

## ğŸ“ ç›¸å…³æ–‡ä»¶

### é…ç½®æ–‡ä»¶
- `/Users/szjason72/gozervi/zervigo.demo/configs/local.env`

### æ•°æ®åº“åˆå§‹åŒ–
- `databases/postgres/init/10-vuecmf-api-mapping.sql`
- `databases/postgres/init/11-vuecmf-menu.sql`
- `databases/postgres/fix-service-credentials.sql`

### æ ¸å¿ƒä»£ç 
- `shared/core/auth/unified_auth_api.go` - ç™»å½•æ¥å£
- `shared/central-brain/vuecmf_handler.go` - èœå•å¤„ç†
- `shared/central-brain/vuecmf/api_mapping_service.go` - APIæ˜ å°„

### å·¥å…·
- `shared/core/cmd/generate-hash/main.go` - ç”Ÿæˆå¯†ç å“ˆå¸Œ
- `shared/core/cmd/check-password/main.go` - éªŒè¯å¯†ç å“ˆå¸Œ

### å¯åŠ¨è„šæœ¬
- `ä¸€é”®ä¿®å¤å¯åŠ¨.sh` - ä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡

### æ–‡æ¡£
- `VueCMFå­—æ®µå¯¹ç…§è¡¨.md` - å®Œæ•´å­—æ®µå¯¹ç…§
- `é…ç½®è¯´æ˜-è¯·ä»”ç»†é˜…è¯».md` - é…ç½®è¯´æ˜
- `æœ€ç»ˆéªŒè¯å’Œæµ‹è¯•æŒ‡å—.md` - æµ‹è¯•æŒ‡å—

---

## âœ… æ‰€æœ‰ä¿®å¤å·²å®Œæˆ

**åç«¯å®Œå…¨æ­£å¸¸ï¼Œæ”¯æŒ VueCMF çš„æ‰€æœ‰æ•°æ®æ ¼å¼å’Œå­—æ®µéœ€æ±‚ï¼**

å¦‚æœè¿˜æœ‰å‰ç«¯è­¦å‘Šæˆ–é”™è¯¯ï¼Œè¯·ï¼š
1. å±•å¼€ Object è­¦å‘ŠæŸ¥çœ‹è¯¦ç»†å†…å®¹
2. æˆªå›¾ç»™æˆ‘çœ‹
3. å‘Šè¯‰æˆ‘å…·ä½“çš„é”™è¯¯ä¿¡æ¯

è¿™æ ·æˆ‘å¯ä»¥é’ˆå¯¹æ€§åœ°è§£å†³å‰ç«¯é—®é¢˜ï¼ğŸš€

