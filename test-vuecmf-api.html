<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>VueCMF APIæµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        h1 { color: #333; border-bottom: 2px solid #409EFF; padding-bottom: 10px; }
        .test-section { margin: 20px 0; padding: 15px; background: #f9f9f9; border-radius: 4px; }
        .test-section h3 { color: #409EFF; margin-top: 0; }
        button { background: #409EFF; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #66b1ff; }
        pre { background: #2c3e50; color: #ecf0f1; padding: 15px; border-radius: 4px; overflow-x: auto; font-size: 12px; }
        .success { color: #67C23A; font-weight: bold; }
        .error { color: #F56C6C; font-weight: bold; }
        .info { color: #409EFF; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª VueCMF API æµ‹è¯•å·¥å…·</h1>
        
        <div class="test-section">
            <h3>1. æµ‹è¯•èœå•API</h3>
            <button onclick="testMenuAPI()">æµ‹è¯•èœå•API</button>
            <pre id="menu-result">ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...</pre>
        </div>

        <div class="test-section">
            <h3>2. æµ‹è¯•ç”¨æˆ·ç®¡ç†API</h3>
            <button onclick="testAdminAPI()">æµ‹è¯•ç”¨æˆ·åˆ—è¡¨</button>
            <button onclick="testAdminFields()">è·å–å­—æ®µå®šä¹‰</button>
            <pre id="admin-result">ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...</pre>
        </div>

        <div class="test-section">
            <h3>3. æµ‹è¯•è§’è‰²ç®¡ç†API</h3>
            <button onclick="testRolesAPI()">æµ‹è¯•è§’è‰²åˆ—è¡¨</button>
            <pre id="roles-result">ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...</pre>
        </div>

        <div class="test-section">
            <h3>4. æµ‹è¯•æƒé™ç®¡ç†API</h3>
            <button onclick="testPermissionsAPI()">æµ‹è¯•æƒé™åˆ—è¡¨</button>
            <pre id="permissions-result">ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...</pre>
        </div>

        <div class="test-section">
            <h3>5. æµ‹è¯•æ¨¡å‹é…ç½®APIï¼ˆVueCMFæ ‡å‡†ï¼‰</h3>
            <button onclick="testModelConfigAPI()">æµ‹è¯•æ¨¡å‹é…ç½®</button>
            <button onclick="testModelFieldAPI()">æµ‹è¯•å­—æ®µé…ç½®</button>
            <pre id="model-result">ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...</pre>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:9000';
        const token = localStorage.getItem('vuecmf_token') || '';

        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const typeClass = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            element.innerHTML = `<span class="${typeClass}">[${timestamp}] ${message}</span>`;
        }

        function logJSON(elementId, data, message = '') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            element.innerHTML = `<span class="info">[${timestamp}] ${message}</span>\n${JSON.stringify(data, null, 2)}`;
        }

        async function testMenuAPI() {
            log('menu-result', 'ğŸ”„ æµ‹è¯•ä¸­...');
            try {
                const response = await fetch(`${API_BASE}/api/v1/menu/nav`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ data: { username: 'admin' } })
                });
                const data = await response.json();
                logJSON('menu-result', data, `âœ… çŠ¶æ€ç : ${response.status}, èœå•æ•°é‡: ${Object.keys(data.data?.nav_menu || {}).length}`);
            } catch (error) {
                log('menu-result', `âŒ é”™è¯¯: ${error.message}`, 'error');
            }
        }

        async function testAdminAPI() {
            log('admin-result', 'ğŸ”„ æµ‹è¯•ä¸­...');
            try {
                const response = await fetch(`${API_BASE}/api/v1/admin/index`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        data: {
                            table_name: 'admin',
                            page: 1,
                            page_size: 20
                        }
                    })
                });
                const data = await response.json();
                logJSON('admin-result', data, `âœ… çŠ¶æ€ç : ${response.status}, æ•°æ®æ€»æ•°: ${data.data?.total || 0}, å½“å‰é¡µ: ${data.data?.list?.length || 0}æ¡`);
            } catch (error) {
                log('admin-result', `âŒ é”™è¯¯: ${error.message}`, 'error');
            }
        }

        async function testAdminFields() {
            log('admin-result', 'ğŸ”„ æµ‹è¯•ä¸­...');
            try {
                // å°è¯•VueCMFæ ‡å‡†çš„å­—æ®µè·å–API
                const response = await fetch(`${API_BASE}/api/v1/model_field/index`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        data: {
                            filter: [{field: 'table_name', condition: '=', value: 'admin'}],
                            page: 1,
                            page_size: 100
                        }
                    })
                });
                const data = await response.json();
                logJSON('admin-result', data, `âœ… çŠ¶æ€ç : ${response.status}, å­—æ®µæ•°: ${data.data?.list?.length || 0}`);
            } catch (error) {
                log('admin-result', `âŒ é”™è¯¯: ${error.message}`, 'error');
            }
        }

        async function testRolesAPI() {
            log('roles-result', 'ğŸ”„ æµ‹è¯•ä¸­...');
            try {
                const response = await fetch(`${API_BASE}/api/v1/roles/index`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        data: {
                            table_name: 'roles',
                            page: 1,
                            page_size: 20
                        }
                    })
                });
                const data = await response.json();
                logJSON('roles-result', data, `âœ… çŠ¶æ€ç : ${response.status}, æ•°æ®æ€»æ•°: ${data.data?.total || 0}`);
            } catch (error) {
                log('roles-result', `âŒ é”™è¯¯: ${error.message}`, 'error');
            }
        }

        async function testPermissionsAPI() {
            log('permissions-result', 'ğŸ”„ æµ‹è¯•ä¸­...');
            try {
                const response = await fetch(`${API_BASE}/api/v1/permissions/index`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        data: {
                            table_name: 'permissions',
                            page: 1,
                            page_size: 20
                        }
                    })
                });
                const data = await response.json();
                logJSON('permissions-result', data, `âœ… çŠ¶æ€ç : ${response.status}, æ•°æ®æ€»æ•°: ${data.data?.total || 0}`);
            } catch (error) {
                log('permissions-result', `âŒ é”™è¯¯: ${error.message}`, 'error');
            }
        }

        async function testModelConfigAPI() {
            log('model-result', 'ğŸ”„ æµ‹è¯•ä¸­...');
            try {
                const response = await fetch(`${API_BASE}/api/v1/model_config/index`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        data: {
                            page: 1,
                            page_size: 20
                        }
                    })
                });
                const data = await response.json();
                logJSON('model-result', data, `VueCMFæ¨¡å‹é…ç½® - çŠ¶æ€ç : ${response.status}`);
            } catch (error) {
                log('model-result', `âŒ é”™è¯¯: ${error.message}`, 'error');
            }
        }

        async function testModelFieldAPI() {
            log('model-result', 'ğŸ”„ æµ‹è¯•ä¸­...');
            try {
                const response = await fetch(`${API_BASE}/api/v1/model_field/index`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        data: {
                            filter: [{field: 'table_name', condition: '=', value: 'admin'}],
                            page: 1,
                            page_size: 100
                        }
                    })
                });
                const data = await response.json();
                logJSON('model-result', data, `å­—æ®µé…ç½® - çŠ¶æ€ç : ${response.status}`);
            } catch (error) {
                log('model-result', `âŒ é”™è¯¯: ${error.message}`, 'error');
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºtokençŠ¶æ€
        window.addEventListener('load', () => {
            if (token) {
                console.log('âœ… å·²æ‰¾åˆ°token:', token.substring(0, 20) + '...');
            } else {
                console.warn('âš ï¸ æœªæ‰¾åˆ°tokenï¼Œè¯·å…ˆç™»å½•');
            }
        });
    </script>
</body>
</html>

